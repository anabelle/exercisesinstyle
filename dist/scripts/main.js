"use strict";var objectFitImages=function(){function e(e,r){if(!e[n].parsingSrcset){var a=c(e);if(a["object-fit"]=a["object-fit"]||"fill",!e[n].s){if("fill"===a["object-fit"])return;if(!e[n].skipTest&&s&&!a["object-position"])return}var o=e[n].ios7src||e.currentSrc||e.src;if(r)o=r;else if(e.srcset&&!l&&window.picturefill){var i=window.picturefill._.ns;e[n].parsingSrcset=!0,e[i]&&e[i].evaled||window.picturefill._.fillImg(e,{reselect:!0}),e[i].curSrc||(e[i].supported=!1,window.picturefill._.fillImg(e,{reselect:!0})),delete e[n].parsingSrcset,o=e[i].curSrc||o}if(e[n].s)e[n].s=o,r&&(e[n].srcAttr=r);else{e[n]={s:o,srcAttr:r||f.call(e,"src"),srcsetAttr:e.srcset},e.src=n;try{e.srcset&&(e.srcset="",Object.defineProperty(e,"srcset",{value:e[n].srcsetAttr})),t(e)}catch(c){e[n].ios7src=o}}e.style.backgroundImage='url("'+o+'")',e.style.backgroundPosition=a["object-position"]||"center",e.style.backgroundRepeat="no-repeat",/scale-down/.test(a["object-fit"])?(e[n].i||(e[n].i=new Image,e[n].i.src=o),function d(){return e[n].i.naturalWidth?void(e[n].i.naturalWidth>e.width||e[n].i.naturalHeight>e.height?e.style.backgroundSize="contain":e.style.backgroundSize="auto"):void setTimeout(d,100)}()):e.style.backgroundSize=a["object-fit"].replace("none","auto").replace("fill","100% 100%")}}function t(t){var r={get:function(){return t[n].s},set:function(r){return delete t[n].i,e(t,r),r}};Object.defineProperty(t,"src",r),Object.defineProperty(t,"currentSrc",{get:r.get})}function r(){c||(HTMLImageElement.prototype.getAttribute=function(e){return!this[n]||"src"!==e&&"srcset"!==e?f.call(this,e):this[n][e+"Attr"]},HTMLImageElement.prototype.setAttribute=function(e,t){!this[n]||"src"!==e&&"srcset"!==e?d.call(this,e,t):this["src"===e?"src":e+"Attr"]=String(t)})}function a(t,r){var o=!u&&!t;if(r=r||{},t=t||"img",c&&!r.skipTest)return!1;"string"==typeof t?t=document.querySelectorAll("img"):t.length||(t=[t]);for(var i=0;i<t.length;i++)t[i][n]=t[i][n]||r,e(t[i]);o&&(document.body.addEventListener("load",function(e){"IMG"===e.target.tagName&&a(e.target,{skipTest:r.skipTest})},!0),u=!0,t="img"),r.watchMQ&&window.addEventListener("resize",a.bind(null,t,{skipTest:r.skipTest}))}var n="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",o=/(object-fit|object-position)\s*:\s*([-\w\s%]+)/g,i=new Image,s="object-fit"in i.style,c="object-position"in i.style,l="string"==typeof i.currentSrc,f=i.getAttribute,d=i.setAttribute,u=!1;return a.supportsObjectFit=s,a.supportsObjectPosition=c,r(),a}();$(document).ready(function(){function e(){$("#cam").imagesLoaded(function(){$(".refresh-bg").css("background-image","url("+e+")"),A+=1});var e=b+"timed="+A;$("#nextframe").attr("src",e)}function t(){if(0==p){if(p=!0,$("#frame-even").hasClass("active"))var e="even",t="odd";if($("#frame-odd").hasClass("active"))var e="odd",t="even";var r=b+"timed="+m;$("#frame-"+t).attr("src",r).load(function(){$("#frame-"+t).addClass("active"),$("#frame-"+e).removeClass("active"),m+=1,p=!1})}}function r(){console.log("Initializing movie..."),a(o,0)}function a(e,t){console.log("Getting cameras..."),$.ajax({dataType:"json",url:"/camaras.json",success:function(r){g=r,console.log("Got cameras: ",g),e(t)}})}function n(e){var t=g[e];if(console.log("Preloading camera: ",e),$("#preloader").addClass("loading"),"image"==t.type)var r=t.url+"?timed="+m;if("mjpg"==t.type)var r=t.url;$("#preloader_img").attr("src",r).load(function(){console.log("Next camara reported done loading"),o(e),setTimeout(function(){$("#preloader_img").attr("src",""),$("#preloader").removeClass("loading"),console.log("Preloader cleared.")},500)})}function o(e){s(),console.log("Loading camera: ",e),d=e,u=g[e],console.log("Loaded camera: ",u),c(1==u.isZoomed?1.25:1),i(u.type)}function i(e){if(console.log("Playing camera of type: ",e),"image"===e){if(console.log("Playing camera of type image: ",u),null==v&&(console.log("Setting up refresh interval."),v=setInterval(function(){i("image")},500)),b=u.url,0==p){if(!$("#frame-even").hasClass("active")&&!$("#frame-odd").hasClass("active")){console.log("No hay frame activo"),$("#frame-even").addClass("active");var t="even",r="odd"}if(p=!0,$("#frame-even").hasClass("active"))var t="even",r="odd";if($("#frame-odd").hasClass("active"))var t="odd",r="even";var a=b+"?timed="+m;$("#frame-"+r).attr("src",a).load(function(){$("#frame-"+r).addClass("active"),$("#frame-"+t).removeClass("active"),objectFitImages(".frame"),m+=1,p=!1})}}else"mjpg"===e?(console.log("Playing camera of type mjpg: ",u),$("#frame-mjpg").addClass("active").attr("src",u.url)):console.log("Camera type not recognized: ",e)}function s(){console.log("Resetting screen..."),$(".frame").attr("src","").removeClass("active"),$(".cam").data("cam","null"),null!=v&&(console.log("Clearing refresh interval."),clearInterval(v)),v=null,p=!1}function c(e){h=e,$(".frame").css("transform","scale("+h+")"),console.log("Changed zoom level to: ",h)}function l(e){"plus"==e&&(h=Math.round(1e12*(h+.1))/1e12),"minus"==e&&(h=Math.round(1e12*(h-.1))/1e12),h<1&&(h=1),c(h)}function f(e){var t=g.length-1,r=null;"next"===e&&(r=d+1,r>t&&(console.log("Se llegó al final de la lista de camaras."),r=0),console.log("Loading next camera...",r),n(r)),"prev"===e&&(r=d-1,r<0&&(console.log("Se llegó al inicio de la lista de camaras."),r=t),console.log("Loading previous camera...",r),n(r))}var d=null,u=null,g=[],m=0,v=null,p=!1,h=1;if($(".refresh-bg").length>0){var A=0,b=$(".refresh-bg").data("cam");setInterval(function(){e()},1e3)}if($(".refresh-interlace").length>0){var p=!1,m=0,b=$(".refresh-interlace").data("cam"),v=setInterval(function(){t()},1e3);objectFitImages(".frame")}$(window).keydown(function(e){var t=e.which;return 13==t||39==t?(f("next"),!1):37==t?(f("prev"),!1):38==t?(l("plus"),!1):40==t?(l("minus"),!1):void 0}),$("#screen").on("click",function(){f("next")}),r()});