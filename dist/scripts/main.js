"use strict";var objectFitImages=function(){function e(e,r){if(!e[n].parsingSrcset){var a=c(e);if(a["object-fit"]=a["object-fit"]||"fill",!e[n].s){if("fill"===a["object-fit"])return;if(!e[n].skipTest&&s&&!a["object-position"])return}var i=e[n].ios7src||e.currentSrc||e.src;if(r)i=r;else if(e.srcset&&!l&&window.picturefill){var o=window.picturefill._.ns;e[n].parsingSrcset=!0,e[o]&&e[o].evaled||window.picturefill._.fillImg(e,{reselect:!0}),e[o].curSrc||(e[o].supported=!1,window.picturefill._.fillImg(e,{reselect:!0})),delete e[n].parsingSrcset,i=e[o].curSrc||i}if(e[n].s)e[n].s=i,r&&(e[n].srcAttr=r);else{e[n]={s:i,srcAttr:r||f.call(e,"src"),srcsetAttr:e.srcset},e.src=n;try{e.srcset&&(e.srcset="",Object.defineProperty(e,"srcset",{value:e[n].srcsetAttr})),t(e)}catch(c){e[n].ios7src=i}}e.style.backgroundImage='url("'+i+'")',e.style.backgroundPosition=a["object-position"]||"center",e.style.backgroundRepeat="no-repeat",/scale-down/.test(a["object-fit"])?(e[n].i||(e[n].i=new Image,e[n].i.src=i),function u(){return e[n].i.naturalWidth?void(e[n].i.naturalWidth>e.width||e[n].i.naturalHeight>e.height?e.style.backgroundSize="contain":e.style.backgroundSize="auto"):void setTimeout(u,100)}()):e.style.backgroundSize=a["object-fit"].replace("none","auto").replace("fill","100% 100%")}}function t(t){var r={get:function(){return t[n].s},set:function(r){return delete t[n].i,e(t,r),r}};Object.defineProperty(t,"src",r),Object.defineProperty(t,"currentSrc",{get:r.get})}function r(){c||(HTMLImageElement.prototype.getAttribute=function(e){return!this[n]||"src"!==e&&"srcset"!==e?f.call(this,e):this[n][e+"Attr"]},HTMLImageElement.prototype.setAttribute=function(e,t){!this[n]||"src"!==e&&"srcset"!==e?u.call(this,e,t):this["src"===e?"src":e+"Attr"]=String(t)})}function a(t,r){var i=!d&&!t;if(r=r||{},t=t||"img",c&&!r.skipTest)return!1;"string"==typeof t?t=document.querySelectorAll("img"):t.length||(t=[t]);for(var o=0;o<t.length;o++)t[o][n]=t[o][n]||r,e(t[o]);i&&(document.body.addEventListener("load",function(e){"IMG"===e.target.tagName&&a(e.target,{skipTest:r.skipTest})},!0),d=!0,t="img"),r.watchMQ&&window.addEventListener("resize",a.bind(null,t,{skipTest:r.skipTest}))}var n="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",i=/(object-fit|object-position)\s*:\s*([-\w\s%]+)/g,o=new Image,s="object-fit"in o.style,c="object-position"in o.style,l="string"==typeof o.currentSrc,f=o.getAttribute,u=o.setAttribute,d=!1;return a.supportsObjectFit=s,a.supportsObjectPosition=c,r(),a}();$(document).ready(function(){function e(){$("#cam").imagesLoaded(function(){$(".refresh-bg").css("background-image","url("+e+")"),b+=1});var e=y+"timed="+b;$("#nextframe").attr("src",e)}function t(){if(0==h){if(h=!0,$("#frame-even").hasClass("active"))var e="even",t="odd";if($("#frame-odd").hasClass("active"))var e="odd",t="even";var r=y+"timed="+v;$("#frame-"+t).attr("src",r).load(function(){$("#frame-"+t).addClass("active"),$("#frame-"+e).removeClass("active"),v+=1,h=!1})}}function r(){console.log("Initializing movie..."),a(i,0)}function a(e,t){console.log("Getting cameras..."),$.ajax({dataType:"json",url:"/camaras.json",success:function(r){g=r,console.log("Got cameras: ",g),e(t)}})}function n(e){var t=g[e];if(console.log("Preloading camera: ",e),$("#preloader").addClass("loading"),"image"==t.type)var r=t.url+"?timed="+v;if("mjpg"==t.type)var r=t.url;$("#preloader_img").attr("src",r).load(function(){console.log("Next camara reported done loading"),i(e),m=setTimeout(function(){$("#preloader_img").attr("src",""),$("#preloader").removeClass("loading"),console.log("Preloader cleared.")},100)})}function i(e){null!=m&&(clearTimeout(m),m=null),s(),console.log("Loading camera: ",e),u=e,d=g[e],console.log("Loaded camera: ",d),c(1==d.isZoomed?1.25:1),console.log("Playing camera of type: ",d.type),o(d.type)}function o(e){if("image"===e){if(null==p&&(console.log("Setting up refresh interval."),p=setInterval(function(){o("image")},33)),y=d.url,0==h){if(!$("#frame-even").hasClass("active")&&!$("#frame-odd").hasClass("active")){console.log("No hay frame activo, iniciando..."),$("#frame-even").addClass("active");var t="even",r="odd"}if(h=!0,$("#frame-even").hasClass("active"))var t="even",r="odd";if($("#frame-odd").hasClass("active"))var t="odd",r="even";var a=y+"?timed="+v;$("#frame-"+r).attr("src",a).load(function(){$("#frame-"+r).addClass("active"),$("#frame-"+t).removeClass("active"),objectFitImages(".frame"),v+=1,h=!1})}}else"mjpg"===e?(console.log("Playing camera of type mjpg: ",d),$("#frame-mjpg").addClass("active").attr("src",d.url)):console.log("Camera type not recognized: ",e)}function s(){console.log("Resetting screen..."),$(".frame").attr("src","").removeClass("active"),$(".cam").data("cam","null"),null!=p&&(console.log("Clearing refresh interval."),clearInterval(p)),p=null,h=!1}function c(e){A=e,$(".frame").css("transform","scale("+A+")"),console.log("Changed zoom level to: ",A)}function l(e){"plus"==e&&(A=Math.round(1e12*(A+.1))/1e12),"minus"==e&&(A=Math.round(1e12*(A-.1))/1e12),A<1&&(A=1),c(A)}function f(e){var t=g.length-1,r=null;"next"===e&&(r=u+1,r>t&&(console.log("Se llegó al final de la lista de camaras."),r=0),console.log("Loading next camera...",r),n(r)),"prev"===e&&(r=u-1,r<0&&(console.log("Se llegó al inicio de la lista de camaras."),r=t),console.log("Loading previous camera...",r),n(r))}var u=null,d=null,g=[],m=null,v=0,p=null,h=!1,A=1;if($(".refresh-bg").length>0){var b=0,y=$(".refresh-bg").data("cam");setInterval(function(){e()},1e3)}if($(".refresh-interlace").length>0){var h=!1,v=0,y=$(".refresh-interlace").data("cam"),p=setInterval(function(){t()},1e3);objectFitImages(".frame")}$(window).keydown(function(e){var t=e.which;return 13==t||39==t?(f("next"),!1):37==t?(f("prev"),!1):38==t?(l("plus"),!1):40==t?(l("minus"),!1):void 0}),$("#screen").on("click",function(){f("next")}),r()});