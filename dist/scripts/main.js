"use strict";var objectFitImages=function(){function e(e,r){if(!e[i].parsingSrcset){var a=c(e);if(a["object-fit"]=a["object-fit"]||"fill",!e[i].s){if("fill"===a["object-fit"])return;if(!e[i].skipTest&&s&&!a["object-position"])return}var n=e[i].ios7src||e.currentSrc||e.src;if(r)n=r;else if(e.srcset&&!l&&window.picturefill){var o=window.picturefill._.ns;e[i].parsingSrcset=!0,e[o]&&e[o].evaled||window.picturefill._.fillImg(e,{reselect:!0}),e[o].curSrc||(e[o].supported=!1,window.picturefill._.fillImg(e,{reselect:!0})),delete e[i].parsingSrcset,n=e[o].curSrc||n}if(e[i].s)e[i].s=n,r&&(e[i].srcAttr=r);else{e[i]={s:n,srcAttr:r||f.call(e,"src"),srcsetAttr:e.srcset},e.src=i;try{e.srcset&&(e.srcset="",Object.defineProperty(e,"srcset",{value:e[i].srcsetAttr})),t(e)}catch(c){e[i].ios7src=n}}e.style.backgroundImage='url("'+n+'")',e.style.backgroundPosition=a["object-position"]||"center",e.style.backgroundRepeat="no-repeat",/scale-down/.test(a["object-fit"])?(e[i].i||(e[i].i=new Image,e[i].i.src=n),function d(){return e[i].i.naturalWidth?void(e[i].i.naturalWidth>e.width||e[i].i.naturalHeight>e.height?e.style.backgroundSize="contain":e.style.backgroundSize="auto"):void setTimeout(d,100)}()):e.style.backgroundSize=a["object-fit"].replace("none","auto").replace("fill","100% 100%")}}function t(t){var r={get:function(){return t[i].s},set:function(r){return delete t[i].i,e(t,r),r}};Object.defineProperty(t,"src",r),Object.defineProperty(t,"currentSrc",{get:r.get})}function r(){c||(HTMLImageElement.prototype.getAttribute=function(e){return!this[i]||"src"!==e&&"srcset"!==e?f.call(this,e):this[i][e+"Attr"]},HTMLImageElement.prototype.setAttribute=function(e,t){!this[i]||"src"!==e&&"srcset"!==e?d.call(this,e,t):this["src"===e?"src":e+"Attr"]=String(t)})}function a(t,r){var n=!g&&!t;if(r=r||{},t=t||"img",c&&!r.skipTest)return!1;"string"==typeof t?t=document.querySelectorAll("img"):t.length||(t=[t]);for(var o=0;o<t.length;o++)t[o][i]=t[o][i]||r,e(t[o]);n&&(document.body.addEventListener("load",function(e){"IMG"===e.target.tagName&&a(e.target,{skipTest:r.skipTest})},!0),g=!0,t="img"),r.watchMQ&&window.addEventListener("resize",a.bind(null,t,{skipTest:r.skipTest}))}var i="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",n=/(object-fit|object-position)\s*:\s*([-\w\s%]+)/g,o=new Image,s="object-fit"in o.style,c="object-position"in o.style,l="string"==typeof o.currentSrc,f=o.getAttribute,d=o.setAttribute,g=!1;return a.supportsObjectFit=s,a.supportsObjectPosition=c,r(),a}();$(document).ready(function(){function e(){$("#cam").imagesLoaded(function(){$(".refresh-bg").css("background-image","url("+e+")"),v+=1});var e=p+"timed="+v;$("#nextframe").attr("src",e)}function t(){if(0==m){if(m=!0,$("#frame-even").hasClass("active"))var e="even",t="odd";if($("#frame-odd").hasClass("active"))var e="odd",t="even";var r=p+"timed="+g;$("#frame-"+t).attr("src",r).load(function(){$("#frame-"+t).addClass("active"),$("#frame-"+e).removeClass("active"),g+=1,m=!1})}}function r(){console.log("Initializing movie..."),a(n,0)}function a(e,t){console.log("Getting cameras..."),$.ajax({dataType:"json",url:"/camaras.json",success:function(r){d=r,console.log("Got cameras: ",d),e(t)}})}function i(e){var t=d[e];if(console.log("Preloading camera: ",e),$("#preloader").addClass("loading"),"image"==t.type)var r=t.url+"?timed="+g;if("mjpg"==t.type)var r=t.url;$("#preloader_img").attr("src",r).load(function(){console.log("Next camara reported done loading"),n(e),setTimeout(function(){$("#preloader_img").attr("src",""),$("#preloader").removeClass("loading"),console.log("Preloader cleared.")},500)})}function n(e){s(),console.log("Loading camera: ",e),l=e,f=d[e],console.log("Loaded camera: ",f),o(f.type)}function o(e){if(console.log("Playing camera of type: ",e),"image"===e){if(console.log("Playing camera of type image: ",f),null==u&&(console.log("Setting up refresh interval."),u=setInterval(function(){o("image")},500)),p=f.url,0==m){if(!$("#frame-even").hasClass("active")&&!$("#frame-odd").hasClass("active")){console.log("No hay frame activo"),$("#frame-even").addClass("active");var t="even",r="odd"}if(m=!0,$("#frame-even").hasClass("active"))var t="even",r="odd";if($("#frame-odd").hasClass("active"))var t="odd",r="even";var a=p+"?timed="+g;$("#frame-"+r).attr("src",a).load(function(){$("#frame-"+r).addClass("active"),$("#frame-"+t).removeClass("active"),objectFitImages(".frame"),g+=1,m=!1})}}else"mjpg"===e?(console.log("Playing camera of type mjpg: ",f),$("#frame-mjpg").addClass("active").attr("src",f.url)):console.log("Camera type not recognized: ",e)}function s(){console.log("Resetting screen..."),$(".frame").attr("src","").removeClass("active"),$(".cam").data("cam","null"),null!=u&&(console.log("Clearing refresh interval."),clearInterval(u)),u=null,m=!1}function c(e){var t=d.length-1,r=null;"next"===e&&(r=l+1,r>t&&(console.log("Se llegó al final de la lista de camaras."),r=0),console.log("Loading next camera...",r),i(r)),"prev"===e&&(r=l-1,r<0&&(console.log("Se llegó al inicio de la lista de camaras."),r=t),console.log("Loading previous camera...",r),i(r))}var l=null,f=null,d=[],g=0,u=null,m=!1;if($(".refresh-bg").length>0){var v=0,p=$(".refresh-bg").data("cam");setInterval(function(){e()},1e3)}if($(".refresh-interlace").length>0){var m=!1,g=0,p=$(".refresh-interlace").data("cam"),u=setInterval(function(){t()},1e3);objectFitImages(".frame")}$(window).keyup(function(e){var t=e.which;return 13==t||39==t?(c("next"),!1):37==t?(c("prev"),!1):void 0}),$("#screen").on("click",function(){c("next")}),r()});